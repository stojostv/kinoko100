package kinoko.database.cassandra.codec;

import com.datastax.oss.driver.api.core.data.UdtValue;
import com.datastax.oss.driver.api.core.type.UserDefinedType;
import com.datastax.oss.driver.api.core.type.codec.MappingCodec;
import com.datastax.oss.driver.api.core.type.codec.TypeCodec;
import com.datastax.oss.driver.api.core.type.reflect.GenericType;
import kinoko.database.cassandra.type.MapTransferInfoUDT;
import kinoko.world.user.data.MapTransferInfo;

import java.util.List;

public final class MapTransferInfoCodec extends MappingCodec<UdtValue, MapTransferInfo> {
    public MapTransferInfoCodec(TypeCodec<UdtValue> innerCodec, GenericType<MapTransferInfo> outerJavaType) {
        super(innerCodec, outerJavaType);
    }

    @Override
    public UserDefinedType getCqlType() {
        return (UserDefinedType) super.getCqlType();
    }

    @Override
    protected MapTransferInfo innerToOuter(UdtValue value) {
        if (value == null) {
            return null;
        }
        final MapTransferInfo mapTransferInfo = new MapTransferInfo();
        final List<Integer> mapTransfer = value.getList(MapTransferInfoUDT.MAP_TRANSFER, Integer.class);
        if (mapTransfer != null) {
            mapTransferInfo.getMapTransfer().addAll(mapTransfer);
        }
        final List<Integer> mapTransferEx = value.getList(MapTransferInfoUDT.MAP_TRANSFER_EX, Integer.class);
        if (mapTransferEx != null) {
            mapTransferInfo.getMapTransferEx().addAll(mapTransferEx);
        }
        final List<Integer> mapTransferPremium = value.getList(MapTransferInfoUDT.MAP_TRANSFER_PREMIUM, Integer.class);
        if (mapTransferPremium != null) {
            mapTransferInfo.getMapTransferPremium().addAll(mapTransferPremium);
        }
        final List<Integer> mapTransferHyper = value.getList(MapTransferInfoUDT.MAP_TRANSFER_HYPER, Integer.class);
        if (mapTransferHyper != null) {
            mapTransferInfo.getMapTransferHyper().addAll(mapTransferHyper);
        }
        return mapTransferInfo;
    }

    @Override
    protected UdtValue outerToInner(MapTransferInfo mapTransferInfo) {
        if (mapTransferInfo == null) {
            return null;
        }
        return getCqlType().newValue()
                .setList(MapTransferInfoUDT.MAP_TRANSFER, mapTransferInfo.getMapTransfer(), Integer.class)
                .setList(MapTransferInfoUDT.MAP_TRANSFER_EX, mapTransferInfo.getMapTransferEx(), Integer.class)
                .setList(MapTransferInfoUDT.MAP_TRANSFER_PREMIUM, mapTransferInfo.getMapTransferPremium(), Integer.class)
                .setList(MapTransferInfoUDT.MAP_TRANSFER_HYPER, mapTransferInfo.getMapTransferHyper(), Integer.class);
    }
}
